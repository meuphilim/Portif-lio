name: ğŸ” IntegraÃ§Ã£o ContÃ­nua

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  ci:
    name: ğŸ§ª Testes e ValidaÃ§Ã£o
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        node-version: [18, 20]
    
    steps:
      - name: ğŸ“¥ Checkout do cÃ³digo
        uses: actions/checkout@v4
        
      - name: ğŸŸ¢ Configurar Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node-version }}
          cache: 'npm'
          
      - name: ğŸ“¦ Instalar dependÃªncias
        run: npm ci --prefer-offline --no-audit --force
        
      - name: ğŸ” Verificar formataÃ§Ã£o
        run: npm run format:check || echo "FormataÃ§Ã£o precisa ser corrigida"
        
      - name: ğŸ§¹ Executar ESLint
        run: npm run lint || echo "Problemas de lint encontrados"
        
      - name: ğŸ”§ Verificar tipos TypeScript
        run: npm run type-check || echo "Problemas de tipos encontrados"
        
      - name: ğŸ—ï¸ Testar build
        run: node scripts/build.js
        env:
          GITHUB_USERNAME: ${{ github.repository_owner }}
          NEXT_PUBLIC_GITHUB_USERNAME: ${{ github.repository_owner }}
          
      - name: ğŸ“Š Verificar tamanho do build
        run: |
          if [ -d "out" ]; then
            echo "ğŸ“ Tamanho do diretÃ³rio out:"
            du -sh out/
            echo "ğŸ“„ Arquivos principais:"
            ls -la out/
          else
            echo "âŒ DiretÃ³rio out nÃ£o encontrado"
            exit 1
          fi
